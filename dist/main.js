(()=>{"use strict";const e=["carrier","battleship","crusier","submarine","destroyer"],t={carrier:5,battleship:4,cruiser:3,submarine:3,destroyer:2},r=(e=10)=>Math.floor(Math.random()*e),a=(e=10)=>[r(e),r(e)],n=e=>{const r={};return e.forEach((e=>r[e]=(e=>{const r=e,a=t[e];let n="horizontal";const l=Array(a).fill(null);return{id:r,length:a,hit:e=>l[e]="hit",getHits:()=>l,isSunk:()=>l.every((e=>"hit"===e)),getDirection:()=>n,changeDirection:()=>{n="horizontal"===n?"vertical":"horizontal"}}})(e))),r},l=()=>{let t=Array(10).fill(null).map((()=>Array(10).fill(null))),r=[];const n=(e,t,r,a)=>{let n=t+r,l=e;return"vertical"===a&&(n=t,l=e+r),[l,n]},l=(e,a,l)=>{const i=e.getDirection(),o=s(e.length,i,a,l);if(o){for(let r=0;r<e.length;r++){const[s,o]=n(a,l,r,i);t[s][o]={ship:e,index:r}}return r.push(e),o}return o},s=(e,r,a,l)=>{const s=[];for(let i=0;i<e;i++){const[e,o]=n(a,l,i,r);if(!(e<10&&o<10))return!1;s.push(t[e][o])}return s.every((e=>null===e))},i=e=>{const[t,r]=a();Math.random()>.5&&e.changeDirection(),l(e,t,r)||i(e)};return{getBoard:()=>t,placeShip:l,areAllShipsPlaced:()=>r.length===e.length,receiveAttack:(e,r)=>(null===t[e][r]?t[e][r]="miss":t[e][r].ship&&(t[e][r].ship.hit(t[e][r].index),t[e][r]="hit"),t[e][r]),areAllShipsSunk:()=>r.every((e=>e.isSunk())),autoPlaceFleet:e=>{for(const t in e)i(e[t])},reset:()=>{t=Array(10).fill(null).map((()=>Array(10).fill(null))),r=[]}}},s=(t="human")=>{let r=n(e);const l=e=>{const[t,r]=a(),n=e.getBoard()[t][r];"miss"===n||"hit"===n?l(e):e.receiveAttack(t,r)};return{getType:()=>t,getFleet:()=>r,attack:(e,t,r)=>r.receiveAttack(e,t),autoAttack:l,resetFleet:()=>r=n(e)}},i={p1Gameboard:document.querySelector(".p1-gameboard"),p2Gameboard:document.querySelector(".p2-gameboard"),p1Grid:document.querySelector(".p1-grid"),p2Grid:document.querySelector(".p2-grid"),infoContainer:document.querySelector(".info-container"),infoText:document.querySelector(".info-text"),autoPlaceBtn:document.querySelector(".fleet-autoplace"),playAgainBtn:document.querySelector(".play-again"),startBtn:document.querySelector(".start"),fleetContainer:document.querySelector(".fleet-container"),fleetDraggable:document.querySelector(".fleet-draggable"),fleetInfo:document.querySelector(".fleet-info")},o=(()=>{const e=(e,t,r)=>`<div class="grid-cell cell-${e}-${t} ${r}" data-y='${e}' data-x='${t}'></div>`;return{renderGrid:(t,r,a)=>{(e=>{e.textContent=""})(t);const n=r.getBoard(),l=n.length;let s="";for(let t=0;t<l;t++)for(let r=0;r<l;r++){let l=n[t][r];null===l?l="":l.ship&&(l="human"===a?l.ship.id:""),s+=e(t,r,l)}t.insertAdjacentHTML("afterbegin",s)},renderFleet:e=>{for(const t in e){const r=document.createElement("div");r.classList.add("ship",`${e[t].id}-container`),r.setAttribute("draggable",!0),r.dataset.ship=`${e[t].id}`;let a="";for(let r=0;r<e[t].length;r++)a+=`<div class=${e[t].id} data-index='${r}'></div>`;r.insertAdjacentHTML("afterbegin",a),i.fleetDraggable.prepend(r)}},autoPlace:()=>{i.startBtn.classList.add("show"),i.fleetInfo.classList.add("hide"),i.fleetInfo.classList.remove("show"),i.fleetDraggable.textContent=""},startGame:()=>{i.p1Gameboard.classList.toggle("grid-disabled"),i.p2Gameboard.classList.toggle("grid-disabled"),i.p2Gameboard.classList.toggle("hide"),i.p2Gameboard.classList.toggle("show"),i.startBtn.classList.remove("show"),i.autoPlaceBtn.classList.remove("show"),i.fleetContainer.classList.toggle("slide-out"),i.fleetContainer.classList.toggle("slide-in")},renderWinner:e=>{i.infoContainer.classList.toggle("show"),i.infoText.textContent=`${e.toUpperCase()}`},playAgain:()=>{i.infoContainer.classList.toggle("show"),i.p1Gameboard.classList.toggle("grid-disabled"),i.p2Gameboard.classList.toggle("grid-disabled"),i.p2Gameboard.classList.toggle("hide"),i.p2Gameboard.classList.toggle("show"),i.fleetInfo.classList.toggle("hide"),i.fleetInfo.classList.toggle("show"),i.autoPlaceBtn.classList.add("show")}}})(),d=o;let c=(e=>{const t=s("human");let r;r=s("singlePlayer"===e?"computer":"human");const a=l(),n=l(),o=((e,t)=>{let r,a;const n=e=>a=Number(e.target.dataset.index),l=e=>{r=e.target},s=n=>{const l=n.target,s=e.getFleet()[r.dataset.ship],o="horizontal"===s.getDirection(),c=Number(l.dataset.y)-(o?0:a),g=Number(l.dataset.x)-(o?a:0);t.placeShip(s,c,g)&&(d.renderGrid(i.p1Grid,t,e.getType()),p(),r.parentElement.removeChild(r),t.areAllShipsPlaced()&&(i.startBtn.classList.add("show"),i.fleetInfo.classList.add("hide"),i.fleetInfo.classList.remove("show")))},o=e=>e.preventDefault(),c=e=>e.preventDefault(),g=()=>{},u=()=>{},p=()=>{const e=document.querySelectorAll(".ship"),t=i.p1Grid.childNodes;for(const t of e)t.addEventListener("mousedown",n),t.addEventListener("dragstart",l),t.addEventListener("dragend",u);for(const e of t)e.addEventListener("dragover",o),e.addEventListener("dragenter",c),e.addEventListener("dragleave",g),e.addEventListener("drop",s)};return{addDragAndDropEvenListeners:p}})(t,a),c=()=>{d.renderFleet(t.getFleet()),o.addDragAndDropEvenListeners(),document.querySelectorAll(".ship").forEach((e=>{e.addEventListener("dblclick",(e=>{const r=e.target.parentElement;t.getFleet()[r.dataset.ship].changeDirection(),r.classList.toggle("vertical")}))}))},g=e=>{const l=e.target;if(l.classList.contains("grid-cell")){const e=l.dataset.y,s=l.dataset.x,o=n.getBoard()[e][s];if("miss"!==o&&"hit"!==o&&(t.attack(e,s,n),r.autoAttack(a),u()),a.areAllShipsSunk()||n.areAllShipsSunk()){let e="";a.areAllShipsSunk()?e="Computer wins!":n.areAllShipsSunk()&&(e="You win!"),i.p2Grid.removeEventListener("click",g),d.renderWinner(e)}}},u=()=>{d.renderGrid(i.p1Grid,a,t.getType()),d.renderGrid(i.p2Grid,n,r.getType())};return{renderGrids:u,renderFleet:c,autoPlace:()=>{a.reset(),a.autoPlaceFleet(t.getFleet()),u(),d.autoPlace()},startGame:()=>{"human"===r.getType&&i.p1Grid.addEventListener("click",g),i.p2Grid.addEventListener("click",g),"computer"===r.getType()&&n.autoPlaceFleet(r.getFleet()),d.startGame()},playAgain:()=>{t.resetFleet(),r.resetFleet(),a.reset(),n.reset(),u(),d.playAgain(),c()}}})("singleplayer");c.renderGrids(),c.renderFleet(),i.autoPlaceBtn.addEventListener("click",(e=>{console.log("autoplaced player fleet"),c.autoPlace()})),i.startBtn.addEventListener("click",(e=>{console.log("GAME START"),c.startGame()})),i.playAgainBtn.addEventListener("click",(e=>{console.log("LETS PLAY AGAIN"),c.playAgain()}))})();